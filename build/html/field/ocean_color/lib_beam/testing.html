
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Application integration and testing &mdash; Developer Cloud Sandbox 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Developer Cloud Sandbox 1.0 documentation" href="../../../index.html" />
    <link rel="up" title="Algal bloom detection with Envisat MERIS" href="index.html" />
    <link rel="next" title="Application exploitation" href="exploitation.html" />
    <link rel="prev" title="Node clustering" href="nodes/clustering.html" />
    <link rel="stylesheet" href="../../../_static/terradue.css" type="text/css" />
  
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">


  </head>
  <body>

<header>
	<div class="container">
		<a href="http://www.terradue.com" target="_blank"><img id="logo" src="../../../_static/t2Logo.png"></a>
		<div id="t2-random-slogan">digital earth scalers</div>
	</div>
</header>
<div id="navbar" class="navbar navbar-default"><!-- navbar-fixed-top-->
    <div class="container">
      <div class="navbar-header pull-right">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html"><img class="navbar-brand-logo" src="../../../_static/sandboxLogo.png" alt="opennebula-logo"/></a>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            <li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
        <b>1.0</b><b class="caret"></b>
    </a>
    <ul class="dropdown-menu globaltoc">
        <li><a href="/devel">1.2 (Devel)</a></li>
        <li><a href="/stable">1.1 (Stable)</a></li>
    </ul>
</li>

            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../start/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">Developer&#8217;s Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/index.html">Design Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Field Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Developer&#8217;s Reference Guide</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Application integration and testing</a><ul>
<li><a class="reference internal" href="#writing-the-application-workflow">Writing the Application workflow</a><ul>
<li><a class="reference internal" href="#the-node-expression-node">The node_expression node</a></li>
<li><a class="reference internal" href="#the-node-arrange-node">The node_arrange node</a></li>
<li><a class="reference internal" href="#the-node-binning-node">The node_binning node</a></li>
<li><a class="reference internal" href="#the-node-clustering-node">The node_clustering node</a></li>
</ul>
</li>
<li><a class="reference internal" href="#putting-the-pieces-together">Putting the pieces together</a><ul>
<li><a class="reference internal" href="#the-expression-job">The expression job</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simulating-and-testing">Simulating and testing</a><ul>
<li><a class="reference internal" href="#node-expression-simulation-and-testing">node_expression simulation and testing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="nodes/clustering.html" title="Previous Chapter: Node clustering"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Node clustering</span>
    </a>
  </li>
  <li>
    <a href="exploitation.html" title="Next Chapter: Application exploitation"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Application expl... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li><div id="sourcelink">
  <a href="https://github.com/Terradue/doc-developer-sandbox/blob/master/source/field/ocean_color/lib_beam/testing.rst" rel="nofollow" target="_blank">Source</a>
</div></li>
            
          </ul>
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
<div class="alert alert-danger alert-error alert-dismissable" style="margin-left: 15px; margin-right: 15px;">
	<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
    <p class="first admonition-title">
        Warning
    </p>
    <p class="last">
        This guide is under development. The material on this page needs to be reviewed for completeness and accuracy. This guide may have not been updated yet from the last release.
    </p>
</div>

      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../start/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">Developer&#8217;s Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/index.html">Design Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Field Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Ocean colour</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Algal bloom detection with Envisat MERIS</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="learn.html">What you will learn</a></li>
<li class="toctree-l4"><a class="reference internal" href="goal.html">Addressing a scientific and processing goal</a></li>
<li class="toctree-l4"><a class="reference internal" href="rational.html">Rationales for the processing chain</a></li>
<li class="toctree-l4"><a class="reference internal" href="data.html">Data preparation</a></li>
<li class="toctree-l4"><a class="reference internal" href="workflow.html">Workflow design</a></li>
<li class="toctree-l4"><a class="reference internal" href="nodes/index.html">Processing nodes design</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">Application integration and testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="exploitation.html">Application exploitation</a></li>
<li class="toctree-l4"><a class="reference internal" href="further.html">Going further</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../insar/index.html">InSAR interferometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dem/index.html">Digital Elevation Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Developer&#8217;s Reference Guide</a></li>
</ul>
<div id="sourcelink">
  <a href="https://github.com/Terradue/doc-developer-sandbox/blob/master/source/field/ocean_color/lib_beam/testing.rst" rel="nofollow" target="_blank">Source</a>
</div>
<form action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>

    <div class="col-md-9">
      
  <div class="section" id="application-integration-and-testing">
<h1>Application integration and testing<a class="headerlink" href="#application-integration-and-testing" title="Permalink to this headline">¶</a></h1>
<p>At this stage of the tutorial, you have defined the job templates. It is now time to organize these in a workflow.</p>
<div class="section" id="writing-the-application-workflow">
<h2>Writing the Application workflow<a class="headerlink" href="#writing-the-application-workflow" title="Permalink to this headline">¶</a></h2>
<p>In the context of the framework, the workflows are Directed Acyclic Graphs (DAG) where nodes and their relation(s), the source(s) are defined.</p>
<p>Each node has:</p>
<ul class="simple">
<li>a unique identifier</li>
<li>a job template id reference</li>
<li>one or more sources</li>
<li>one or more parameters and associated values to overide the default value (if defined in the job template).</li>
</ul>
<div class="section" id="the-node-expression-node">
<h3>The node_expression node<a class="headerlink" href="#the-node-expression-node" title="Permalink to this headline">¶</a></h3>
<p>The first node of the workflow instantiates the expression job template.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;node</span> <span class="na">id=</span><span class="s">&quot;node_expression&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;job</span> <span class="na">id=</span><span class="s">&quot;expression&quot;</span><span class="nt">&gt;&lt;/job&gt;</span>
</pre></div>
</div>
<p>As source, this node uses the sandbox catalogue:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;sources&gt;</span>
<span class="nt">&lt;source</span> <span class="na">refid=</span><span class="s">&quot;cas:series&quot;</span><span class="nt">&gt;</span>http://localhost/catalogue/sandbox/MER_RR__1P/description<span class="nt">&lt;/source&gt;</span>
<span class="nt">&lt;/sources&gt;</span>
</pre></div>
</div>
<p>As parameters, it defines the values for the start and enddate and leave the expression default value.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;parameters&gt;</span>
  <span class="nt">&lt;parameter</span> <span class="na">type=</span><span class="s">&quot;opensearch&quot;</span> <span class="na">target=</span><span class="s">&quot;time:start&quot;</span> <span class="na">id=</span><span class="s">&quot;startdate&quot;</span><span class="nt">&gt;</span>2012-04-02<span class="nt">&lt;/parameter&gt;</span>
  <span class="nt">&lt;parameter</span> <span class="na">type=</span><span class="s">&quot;opensearch&quot;</span> <span class="na">target=</span><span class="s">&quot;time:end&quot;</span> <span class="na">id=</span><span class="s">&quot;enddate&quot;</span><span class="nt">&gt;</span>2012-04-06<span class="nt">&lt;/parameter&gt;</span>
<span class="nt">&lt;/parameters&gt;</span>
</pre></div>
</div>
<p>The complete node definition is:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;node</span> <span class="na">id=</span><span class="s">&quot;node_expression&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;job</span> <span class="na">id=</span><span class="s">&quot;expression&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;sources&gt;</span>
      <span class="nt">&lt;source</span> <span class="na">refid=</span><span class="s">&quot;cas:series&quot;</span><span class="nt">&gt;</span>http://localhost/catalogue/sandbox/MER_RR__1P/description<span class="nt">&lt;/source&gt;</span>
    <span class="nt">&lt;/sources&gt;</span>
    <span class="nt">&lt;parameters&gt;</span>
      <span class="nt">&lt;parameter</span> <span class="na">type=</span><span class="s">&quot;opensearch&quot;</span> <span class="na">target=</span><span class="s">&quot;time:start&quot;</span> <span class="na">id=</span><span class="s">&quot;startdate&quot;</span><span class="nt">&gt;</span>2012-04-02<span class="nt">&lt;/parameter&gt;</span>
      <span class="nt">&lt;parameter</span> <span class="na">type=</span><span class="s">&quot;opensearch&quot;</span> <span class="na">target=</span><span class="s">&quot;time:end&quot;</span> <span class="na">id=</span><span class="s">&quot;enddate&quot;</span><span class="nt">&gt;</span>2012-04-06<span class="nt">&lt;/parameter&gt;</span>
      <span class="nt">&lt;/parameters&gt;</span>
<span class="nt">&lt;/node&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="the-node-arrange-node">
<h3>The node_arrange node<a class="headerlink" href="#the-node-arrange-node" title="Permalink to this headline">¶</a></h3>
<p>The node_arrange instantiates the arrange job template and uses the default value for the period. The node inputs are not a reference to a catalogue as for the expression node, but the results of the expression node:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;node</span> <span class="na">id=</span><span class="s">&quot;node_arrange&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;job</span> <span class="na">id=</span><span class="s">&quot;arrange&quot;</span><span class="nt">&gt;&lt;/job&gt;</span>
  <span class="nt">&lt;sources&gt;</span>
    <span class="nt">&lt;source</span> <span class="na">refid=</span><span class="s">&quot;wf:node&quot;</span><span class="nt">&gt;</span>node_expression<span class="nt">&lt;/source&gt;</span>
  <span class="nt">&lt;/sources&gt;</span>
  <span class="nt">&lt;parameters&gt;</span>
  <span class="nt">&lt;/parameters&gt;</span>
<span class="nt">&lt;/node&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="the-node-binning-node">
<h3>The node_binning node<a class="headerlink" href="#the-node-binning-node" title="Permalink to this headline">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;node</span> <span class="na">id=</span><span class="s">&quot;node_binning&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;job</span> <span class="na">id=</span><span class="s">&quot;binning&quot;</span><span class="nt">&gt;&lt;/job&gt;</span>
  <span class="nt">&lt;sources&gt;</span>
    <span class="nt">&lt;source</span> <span class="na">refid=</span><span class="s">&quot;wf:node&quot;</span><span class="nt">&gt;</span>node_arrange<span class="nt">&lt;/source&gt;</span>
  <span class="nt">&lt;/sources&gt;</span>
  <span class="nt">&lt;parameters&gt;</span>
  <span class="nt">&lt;/parameters&gt;</span>
<span class="nt">&lt;/node&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="the-node-clustering-node">
<h3>The node_clustering node<a class="headerlink" href="#the-node-clustering-node" title="Permalink to this headline">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;node</span> <span class="na">id=</span><span class="s">&quot;node_clustering&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;job</span> <span class="na">id=</span><span class="s">&quot;clustering&quot;</span><span class="nt">&gt;&lt;/job&gt;</span>
  <span class="nt">&lt;sources&gt;</span>
    <span class="nt">&lt;source</span> <span class="na">refid=</span><span class="s">&quot;wf:node&quot;</span><span class="nt">&gt;</span>node_binning<span class="nt">&lt;/source&gt;</span>
  <span class="nt">&lt;/sources&gt;</span>
  <span class="nt">&lt;parameters&gt;</span>
  <span class="nt">&lt;/parameters&gt;</span>
<span class="nt">&lt;/node&gt;</span>
</pre></div>
</div>
<p>The complete workflow is attached.</p>
</div>
</div>
<div class="section" id="putting-the-pieces-together">
<h2>Putting the pieces together<a class="headerlink" href="#putting-the-pieces-together" title="Permalink to this headline">¶</a></h2>
<p>You have defined the job template and the workflow. The Application Descriptor file is now complete.
At this stage, you will create the job folder under /application, the streaming executables and create the application files.</p>
<div class="section" id="the-expression-job">
<h3>The expression job<a class="headerlink" href="#the-expression-job" title="Permalink to this headline">¶</a></h3>
<p>The expression job application invokes a Bash script, named beam_expr.sh that takes one or more MERIS products (available in the filesystem), the expression, the output band name and an folder to sotre the results.
The beam_expr.sh is an executable that can be invoked manually.
Create the file in the folder /application/expression/bin/ and make executable with</p>
<div class="highlight-bash"><div class="highlight"><pre>chmod 755 /application/expression/bin/beam_expr.sh
</pre></div>
</div>
<p>You will test the script to understand how it works.</p>
<p>First, copy one MERIS product available in the sandbox catalogue to your home:</p>
<div class="highlight-bash"><div class="highlight"><pre>ciop-copy -o ~ <span class="s2">&quot;http://localhost/catalogue/sandbox/MER_RR__1P/rdf?count=1&quot;</span>
</pre></div>
</div>
<p>Notice the output of the ciop-copy utility, it is the local path of the copied file. It is often usefull to store this value in a variable to access the copied product.</p>
<p>Invoke the beam_expr.sh script:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">export </span><span class="nv">BEAM_HOME</span><span class="o">=</span><span class="nv">$_CIOP_APPLICATION_PATH</span>/share/beam-4.11
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$BEAM_HOME</span>/bin:<span class="nv">$PATH</span>
<span class="nv">$_CIOP_APPLICATION_PATH</span>/expression/bin/beam_expr.sh -b out -e <span class="s2">&quot;l1_flags.INVALID?0:radiance_13&gt;17?0:100+radiance_9-(radiance_8+(radiance_10-radiance_8)*27.524/72.570)&quot;</span> -o ~ ~/MER_RR__1PRLRA20120405_174214_000026213113_00228_52828_0110.N1
</pre></div>
</div>
<p>You&#8217;ll find in your home the result: MER_RR__1PRLRA20120405_174214_000026213113_00228_52828_0110.N1.dim.tgz</p>
<p>You will now create the streaming executable (run) using the Bash scripting language that invokes the beam_arithm.sh executable.</p>
<p>The beam_expr.sh needs the arithmetic expression value. To do so, you will use the ciop-getparam function (part of the ciop_job_include that needs to be sourced):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="nb">source</span> <span class="k">${</span><span class="nv">ciop_job_include</span><span class="k">}</span>
<span class="nv">expression</span><span class="o">=</span><span class="s2">&quot;`ciop-getparam expression`&quot;</span>
</pre></div>
</div>
<p>Ok, you have the variable expression with the value &#8220;l1_flags.INVALID?0:radiance_13&gt;17?0:100+radiance_9-(radiance_8+(radiance_10-radiance_8)*27.524/72.570)&#8221;</p>
<p>You&#8217;ll proceed with the copy of the MERIS products whose RDF URLs are passed as the result of the OpenSearch query:</p>
<div class="highlight-bash"><div class="highlight"><pre>opensearch-client -p <span class="nb">time</span>:start<span class="o">=</span>2012-04-05 -p <span class="nb">time</span>:end<span class="o">=</span>2012-04-06 http://localhost/catalogue/sandbox/MER_RR__1P/description
</pre></div>
</div>
<p>which returns:</p>
<div class="highlight-bash"><div class="highlight"><pre>http://localhost/catalogue/sandbox/MER_RR__1P/MER_RR__1PRLRA20120406_102429_000026213113_00238_52838_0211.N1/rdf
http://localhost/catalogue/sandbox/MER_RR__1P/MER_RR__1PRLRA20120405_174214_000026213113_00228_52828_0110.N1/rdf
http://localhost/catalogue/sandbox/MER_RR__1P/MER_RR__1PRLRA20120405_142147_000026243113_00226_52826_0090.N1/rdf
http://localhost/catalogue/sandbox/MER_RR__1P/MER_RR__1PRLRA20120405_092107_000026213113_00223_52823_0052.N1/rdf
http://localhost/catalogue/sandbox/MER_RR__1P/MER_RR__1PRLRA20120404_231946_000026213113_00217_52817_9862.N1/rdf
</pre></div>
</div>
<p>So, behind the scenes, the streaming executable is invoked with a command similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre>opensearch-client -p <span class="nb">time</span>:start<span class="o">=</span>2012-04-05 -p <span class="nb">time</span>:end<span class="o">=</span>2012-04-06 http://localhost/catalogue/sandbox/MER_RR__1P/description | /application/expression/run
</pre></div>
</div>
<p>You&#8217;ll edit the streaming executable (/application/expression/run) to add the copy of the MERIS products:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="nb">source</span> <span class="k">${</span><span class="nv">ciop_job_include</span><span class="k">}</span>
<span class="nv">expression</span><span class="o">=</span><span class="s2">&quot;`ciop-getparam expression`&quot;</span>

<span class="k">while </span><span class="nb">read </span>inputfile
<span class="k">do</span>
<span class="k">  </span><span class="nv">retrieved</span><span class="o">=</span><span class="sb">`</span>ciop-copy -o <span class="nv">$TMPDIR</span> <span class="s2">&quot;$inputfile&quot;</span><span class="sb">`</span>
<span class="k">done</span>
</pre></div>
</div>
<p>The ciop-copy utility is invoked with the option -o set to $TMPDIR. This variable contains the path to a unique temporary folder that only one instance of the streaming executable will use (concurrency in parallel tasks is thus avoided).</p>
<p>You have the expression value and the MERIS file copied to the temporary folder. You will now add the creation of the output folder for the results and invoke beam_expr.sh</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="nb">source</span> <span class="k">${</span><span class="nv">ciop_job_include</span><span class="k">}</span>
<span class="nv">expression</span><span class="o">=</span><span class="s2">&quot;`ciop-getparam expression`&quot;</span>

mkdir -p <span class="nv">$TMPDIR</span>/output
<span class="nb">export </span><span class="nv">OUTPUTDIR</span><span class="o">=</span><span class="nv">$TMPDIR</span>/output

<span class="k">while </span><span class="nb">read </span>inputfile
<span class="k">do</span>
<span class="k">  </span><span class="nv">retrieved</span><span class="o">=</span><span class="sb">`</span>ciop-copy -o <span class="nv">$TMPDIR</span> <span class="s2">&quot;$inputfile&quot;</span><span class="sb">`</span>
  <span class="nv">$_CIOP_APPLICATION_PATH</span>/expression/bin/beam_expr.sh -o <span class="nv">$OUTPUTDIR</span> -e <span class="s2">&quot;$expression&quot;</span> -b out <span class="nv">$retrieved</span> 1&gt;&amp;2
<span class="k">done</span>
</pre></div>
</div>
<p>If this streaming executable is run, the $OUTPUTDIR folder will contain all the beam_expr.sh results, in order to make these available in the distributed file system, these have to be published with the ciop-publish utility.
After the publication to the distributed filesystem, the input and output are no longer needed, so you will free the space and leave the environment clean for the next MERIS product to be processed.
ciop-publish plays another important role: it tells the framework what has been produced (in practical terms, the inputs of the next node: node_arrange).</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="nb">source</span> <span class="k">${</span><span class="nv">ciop_job_include</span><span class="k">}</span>
<span class="nv">expression</span><span class="o">=</span><span class="s2">&quot;`ciop-getparam expression`&quot;</span>

mkdir -p <span class="nv">$TMPDIR</span>/output
<span class="nb">export </span><span class="nv">OUTPUTDIR</span><span class="o">=</span><span class="nv">$TMPDIR</span>/output

<span class="k">while </span><span class="nb">read </span>inputfile
<span class="k">do</span>
<span class="k">  </span><span class="nv">retrieved</span><span class="o">=</span><span class="sb">`</span>ciop-copy -o <span class="nv">$TMPDIR</span> <span class="s2">&quot;$inputfile&quot;</span><span class="sb">`</span>
  <span class="nv">$_CIOP_APPLICATION_PATH</span>/expression/bin/beam_expr.sh -o <span class="nv">$OUTPUTDIR</span> -e <span class="s2">&quot;$expression&quot;</span> -b out <span class="nv">$retrieved</span> 1&gt;&amp;2
  ciop-publish <span class="nv">$OUTPUTDIR</span>/*.tgz
  rm -fr <span class="nv">$retrieved</span> <span class="nv">$OUTPUTDIR</span>/*.tgz
<span class="k">done</span>
</pre></div>
</div>
<p>You&#8217;re done! The streaming executable of the job template expression is created.
The streaming executable can of course be enhanced with the error handling, checks on the outcomes of the commands, etc.
The final expression node template streaming executable is attached and includes extended comments.</p>
</div>
</div>
<div class="section" id="simulating-and-testing">
<h2>Simulating and testing<a class="headerlink" href="#simulating-and-testing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="node-expression-simulation-and-testing">
<h3>node_expression simulation and testing<a class="headerlink" href="#node-expression-simulation-and-testing" title="Permalink to this headline">¶</a></h3>
<p>The node_expression will produce:</p>
<div class="highlight-bash"><div class="highlight"><pre>MER_RR__1PRLRA20120406_102429_000026213113_00238_52838_0211.N1.dim.tgz
MER_RR__1PRLRA20120405_174214_000026213113_00228_52828_0110.N1.dim.tgz
MER_RR__1PRLRA20120405_142147_000026243113_00226_52826_0090.N1.dim.tgz
MER_RR__1PRLRA20120405_092107_000026213113_00223_52823_0052.N1.dim.tgz
MER_RR__1PRLRA20120404_231946_000026213113_00217_52817_9862.N1.dim.tgz
</pre></div>
</div>
<p>These files are all available in the distributed filesystem.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer>
	<div class="container">
		<img src="../../../_static/t2LogoLittleWhite.png">
		&nbsp;&nbsp;&nbsp;Copyright 2006-2014 &copy; Terradue. All Rights Reserved. Please send comments to <a href="mailto:info [at] terradue [dot] com">info</a>. <p class="pull-right">This site is hosted by <a href="http://www.terradue.com">Terradue</a>.</p>
	</div>
</footer>

  </body>
</html>